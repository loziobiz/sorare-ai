(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{4632:(e,l,t)=>{Promise.resolve().then(t.bind(t,9370))},6132:(e,l,t)=>{"use strict";t.d(l,{A:()=>a});let a=(0,t(1847).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6170:(e,l,t)=>{"use strict";t.d(l,{p:()=>s});var a=t(5155),r=t(5016);function s(e){let{className:l,type:t,...s}=e;return(0,a.jsx)("input",{className:(0,r.cn)("h-9 w-full min-w-0 rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-xs outline-none transition-[color,box-shadow] selection:bg-primary selection:text-primary-foreground file:inline-flex file:h-7 file:border-0 file:bg-transparent file:font-medium file:text-foreground file:text-sm placeholder:text-muted-foreground disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:bg-input/30","focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50","aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40",l),"data-slot":"input",type:t,...s})}},9370:(e,l,t)=>{"use strict";t.d(l,{LineupBuilder:()=>L});var a=t(5155),r=t(1847);let s=(0,r.A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var i=t(5917);let n=(0,r.A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var o=t(2619),c=t.n(o),d=t(63),u=t(2115),m=t(9220),f=t(1650),x=t(8271),h=t(2559),v=t(7003),b=t(4916),p=t(6170);let g=(0,r.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),j=(0,r.A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var y=t(6132);let w=(0,r.A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var N=t(5016);function k(e){let{message:l,type:t="success",duration:r=3e3,onClose:s}=e,[i,n]=(0,u.useState)(!0);(0,u.useEffect)(()=>{let e=setTimeout(()=>{n(!1),setTimeout(()=>null==s?void 0:s(),300)},r);return()=>clearTimeout(e)},[r,s]);let o={success:(0,a.jsx)(g,{className:"h-5 w-5 text-green-500"}),error:(0,a.jsx)(j,{className:"h-5 w-5 text-red-500"}),info:(0,a.jsx)(y.A,{className:"h-5 w-5 text-blue-500"})};return(0,a.jsxs)("div",{className:(0,N.cn)("fixed right-4 bottom-4 z-50 flex items-center gap-3 rounded-lg border p-4 shadow-lg transition-all duration-300",{success:"bg-green-50 border-green-200",error:"bg-red-50 border-red-200",info:"bg-blue-50 border-blue-200"}[t],i?"translate-y-0 opacity-100":"translate-y-4 opacity-0"),children:[o[t],(0,a.jsx)("span",{className:"font-medium text-slate-700 text-sm",children:l}),(0,a.jsx)("button",{className:"text-slate-400 hover:text-slate-600",onClick:()=>{n(!1),setTimeout(()=>null==s?void 0:s(),300)},type:"button",children:(0,a.jsx)(w,{className:"h-4 w-4"})})]})}function C(e){let{toasts:l,onRemove:t}=e;return(0,a.jsx)("div",{className:"fixed right-4 bottom-4 z-50 flex flex-col gap-2",children:l.map(e=>(0,a.jsx)(k,{message:e.message,onClose:()=>t(e.id),type:e.type},e.id))})}let A=0;function E(e,l){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"success",a="toast-".concat(A++);e(e=>[...e,{id:a,message:l,type:t}]),setTimeout(()=>{e(e=>e.filter(e=>e.id!==a))},3e3)}var S=t(8070),z=t(373),T=t(809),F=t(8759);let M=(0,r.A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var P=t(5239);function O(e){let{label:l,card:t,isActive:r,onClick:s}=e;return t?(0,a.jsxs)("button",{"aria-label":"Rimuovi ".concat(t.name),className:"group relative transition-transform hover:scale-105",onClick:s,type:"button",children:[(0,a.jsx)("div",{className:"absolute top-1 right-1 z-20 rounded-full bg-black/60 p-1 opacity-0 transition-opacity group-hover:opacity-100",children:(0,a.jsx)(w,{className:"h-4 w-4 text-white"})}),t.pictureUrl?(0,a.jsx)(P.default,{alt:t.name,className:"h-49 w-30 rounded-lg object-cover shadow-lg",height:176,src:t.pictureUrl,unoptimized:!0,width:128}):(0,a.jsx)("div",{className:"flex h-44 w-32 items-center justify-center rounded-lg bg-slate-700 font-bold text-2xl text-white shadow-lg",children:t.name.charAt(0)})]}):(0,a.jsx)("button",{"aria-label":"Seleziona ".concat(l),className:(0,N.cn)("group flex flex-col items-center transition-transform hover:scale-105",r&&"scale-105"),onClick:s,type:"button",children:(0,a.jsxs)("div",{className:(0,N.cn)("flex h-44 w-32 flex-col items-center justify-center rounded-xl border-2 border-dashed transition-all",r?"border-violet-400 bg-violet-500/20":"border-white/40 bg-white/10 hover:border-white/60 hover:bg-white/20"),children:[(0,a.jsx)("span",{className:(0,N.cn)("mb-3 font-semibold text-base",r?"text-violet-200":"text-white/70"),children:l}),(0,a.jsx)("div",{className:(0,N.cn)("flex h-12 w-12 items-center justify-center rounded-full border-2 border-dashed transition-colors",r?"border-violet-300 text-violet-200":"border-white/40 text-white/50 group-hover:border-white/60"),children:(0,a.jsx)(M,{className:"h-6 w-6"})})]})})}let D={ATT:["Forward"],EX:["Forward","Midfielder","Defender"],DIF:["Defender"],CEN:["Midfielder"],POR:["Goalkeeper"]},I=[{position:"ATT",card:null},{position:"EX",card:null},{position:"DIF",card:null},{position:"CEN",card:null},{position:"POR",card:null}];function L(){var e,l,t,r,o,g,j,y,w,k;let A=(0,d.useRouter)(),M=(0,d.useSearchParams)(),[P,L]=(0,u.useState)(!0),[R,_]=(0,u.useState)(""),[X,G]=(0,u.useState)([]),[U,q]=(0,u.useState)(I),[K,H]=(0,u.useState)(null),[$,B]=(0,u.useState)(""),[J,Q]=(0,u.useState)(""),[V,W]=(0,u.useState)("all"),[Y,Z]=(0,u.useState)("l5"),[ee,el]=(0,u.useState)(!1),[et,ea]=(0,u.useState)(""),[er,es]=(0,u.useState)(null),[ei,en]=(0,u.useState)([]);(0,S.KX)();let eo=(0,u.useMemo)(()=>{let e=new Map;for(let r of X){var l,t,a;for(let s of null!=(a=null==(t=r.anyPlayer)||null==(l=t.activeClub)?void 0:l.activeCompetitions)?a:[])if("DOMESTIC_LEAGUE"===s.format&&s.country){let l="".concat(s.name,"|").concat(s.country.code);if(!z.jK||Object.hasOwn(z.UK,l)){let t=z.UK[l],a=null!=t?t:l;e.set(l,a)}}}return Array.from(e.entries()).map(e=>{let[l,t]=e;return{value:l,label:t}}).sort((e,l)=>e.label.localeCompare(l.label))},[X]),ec=(0,u.useMemo)(()=>new Set(U.filter(e=>e.card).map(e=>{var l;return null==(l=e.card)?void 0:l.slug})),[U]),ed=(0,u.useMemo)(()=>{let e=X.filter(e=>!ec.has(e.slug));if(J){let[l,t]=J.split("|");e=e.filter(e=>{var a,r,s;return null==(s=e.anyPlayer)||null==(r=s.activeClub)||null==(a=r.activeCompetitions)?void 0:a.some(e=>{var a;return"DOMESTIC_LEAGUE"===e.format&&e.name===l&&(null==(a=e.country)?void 0:a.code)===t})})}if("all"!==V&&(e=e.filter(e=>e.rarityTyped.toLowerCase()===V)),K){let l=D[K];e=e.filter(e=>{var t;return null==(t=e.anyPositions)?void 0:t.some(e=>l.includes(e))})}if($.trim()){let l=$.toLowerCase();e=e.filter(e=>{var t,a,r;return e.name.toLowerCase().includes(l)||(null==(r=e.anyPlayer)||null==(a=r.activeClub)||null==(t=a.name)?void 0:t.toLowerCase().includes(l))})}return ee&&(e=e.filter(e=>!0===e.inSeasonEligible)),e.sort((e,l)=>{var t,a,r,s,i,n,o,c,d,u,m,f,x,h;switch(Y){case"name":return e.name.localeCompare(l.name);case"team":return(null!=(i=null==(a=e.anyPlayer)||null==(t=a.activeClub)?void 0:t.name)?i:"").localeCompare(null!=(n=null==(s=l.anyPlayer)||null==(r=s.activeClub)?void 0:r.name)?n:"");case"l5":return(null!=(o=l.l5Average)?o:0)-(null!=(c=e.l5Average)?c:0);case"l10":return(null!=(d=l.l10Average)?d:0)-(null!=(u=e.l10Average)?u:0);case"l15":return(null!=(m=l.l15Average)?m:0)-(null!=(f=e.l15Average)?f:0);case"l40":return(null!=(x=l.l40Average)?x:0)-(null!=(h=e.l40Average)?h:0);default:return 0}}),e},[X,ec,J,V,K,$,Y,ee]),eu=(0,u.useMemo)(()=>2*(U.filter(e=>e.card).length>=3),[U]);(0,u.useMemo)(()=>({current:Math.round(U.reduce((e,l)=>{var t,a;return e+(null!=(a=null==(t=l.card)?void 0:t.l5Average)?a:0)},0)),max:260,bonus:eu}),[U,eu]);let em=(0,u.useCallback)(async()=>{try{let e=await T.db.cache.get("user_cards");if(!e)return!1;let{timestamp:l,value:t,ttl:a}=e,r=Date.now()-l;if(a&&r>a)return await T.db.cache.delete("user_cards"),!1;return G(t.cards),L(!1),!0}catch(e){return!1}},[]),ef=(0,u.useCallback)(async(e,l)=>{await T.db.cache.put({key:"user_cards",value:{cards:e,userSlug:l},timestamp:Date.now(),ttl:T.HX.LONG})},[]),ex=(0,u.useCallback)(async()=>{L(!0),_("");try{let e=await (0,F.T7)({enablePagination:!0});G(e.cards),await ef(e.cards,e.userSlug)}catch(e){_(e instanceof Error?e.message:"Errore nel caricamento")}finally{L(!1)}},[ef]),eh=(0,u.useCallback)(async()=>{await em()||await ex()},[em,ex]);(0,u.useEffect)(()=>{eh()},[eh]),(0,u.useEffect)(()=>{let e=M.get("edit");e&&X.length&&(async()=>{try{let l=Number.parseInt(e,10),t=await T.db.savedFormations.get(l);if(t){es(l),ea(t.name),Q(t.league);let e=[...I];if(t.slots&&t.slots.length>0)for(let l of t.slots){let a=t.cards.find(e=>e.slug===l.cardSlug);if(a){let t=e.findIndex(e=>e.position===l.position);-1!==t&&(e[t]={position:l.position,card:a})}}else for(let l of t.cards){let t=function(e){if(!e.anyPositions||0===e.anyPositions.length)return null;let l=e.anyPositions[0];return"Goalkeeper"===l?"POR":"Defender"===l?"DIF":"Midfielder"===l?"CEN":"Forward"===l?"ATT":null}(l);if(t){let a=e.findIndex(e=>e.position===t);-1!==a&&(e[a]={position:t,card:l})}}q(e)}}catch(e){console.error("Error loading formation:",e)}})()},[M,X]);let ev=e=>{let l=U.find(l=>l.position===e);(null==l?void 0:l.card)?(q(l=>l.map(l=>l.position===e?{...l,card:null}:l)),H(null)):H(K===e?null:e)},eb=async()=>{if(U.filter(e=>e.card).length<5)return void _("Completa la formazione prima di confermare");if(!et.trim())return void _("Inserisci un nome per la formazione");if(!J)return void _("Seleziona una lega");try{let e=U.map(e=>e.card).filter(e=>null!==e),l=U.filter(e=>null!==e.card).map(e=>({position:e.position,cardSlug:e.card.slug}));er?(await T.db.savedFormations.update(er,{name:et.trim(),league:J,cards:e,slots:l}),E(en,"Formazione aggiornata con successo!","success")):(await T.db.savedFormations.add({name:et.trim(),league:J,cards:e,slots:l,createdAt:Date.now()}),E(en,"Formazione salvata con successo!","success")),ea(""),q(I),es(null),_(""),A.push("/saved-lineups")}catch(e){_(e instanceof Error?e.message:"Errore nel salvataggio")}};return P?(0,a.jsx)("div",{className:"flex h-[80vh] items-center justify-center",children:(0,a.jsx)(f.k,{icon:"loader",message:"Caricamento carte..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(x.x,{}),(0,a.jsx)(C,{onRemove:e=>en(l=>l.filter(l=>l.id!==e)),toasts:ei}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:gap-6",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:sticky lg:top-4 lg:w-[520px]",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center gap-3",children:[(0,a.jsx)(c(),{href:"/cards",children:(0,a.jsx)(v.$,{size:"icon",variant:"ghost",children:(0,a.jsx)(s,{className:"h-5 w-5"})})}),(0,a.jsx)("h1",{className:"font-bold text-2xl text-slate-800",children:er?"Modifica Formazione":"Formazione"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"mb-2 block font-medium text-sm",htmlFor:"formation-name",children:"Nome formazione"}),(0,a.jsx)(p.p,{className:"h-11",id:"formation-name",onChange:e=>ea(e.target.value),placeholder:"Nome formazione (obbligatorio)",required:!0,value:et})]}),(0,a.jsxs)("div",{className:"relative flex aspect-[7/8] flex-col overflow-hidden rounded-2xl bg-gradient-to-b from-emerald-600 to-emerald-700 shadow-xl",children:[(0,a.jsx)("div",{className:"absolute inset-5 rounded-lg border-2 border-white/30"}),(0,a.jsx)("div",{className:"absolute top-1/2 right-5 left-5 h-0.5 -translate-y-1/2 bg-white/30"}),(0,a.jsx)("div",{className:"absolute top-1/2 left-1/2 h-28 w-28 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-white/30"}),(0,a.jsx)("div",{className:"absolute bottom-5 left-1/2 h-24 w-40 -translate-x-1/2 border-2 border-white/30 border-b-0"}),(0,a.jsx)("div",{className:"absolute top-5 left-1/2 h-24 w-40 -translate-x-1/2 border-2 border-white/30 border-t-0"}),(0,a.jsxs)("div",{className:"relative z-10 flex h-full flex-col justify-between gap-3 px-6 py-4",children:[(0,a.jsxs)("div",{className:"flex justify-around",children:[(0,a.jsx)(O,{card:null!=(g=null==(e=U.find(e=>"ATT"===e.position))?void 0:e.card)?g:null,isActive:"ATT"===K,label:"ATT",onClick:()=>ev("ATT")}),(0,a.jsx)(O,{card:null!=(j=null==(l=U.find(e=>"EX"===e.position))?void 0:l.card)?j:null,isActive:"EX"===K,label:"EX",onClick:()=>ev("EX")})]}),(0,a.jsxs)("div",{className:"flex justify-around",children:[(0,a.jsx)(O,{card:null!=(y=null==(t=U.find(e=>"DIF"===e.position))?void 0:t.card)?y:null,isActive:"DIF"===K,label:"DIF",onClick:()=>ev("DIF")}),(0,a.jsx)(O,{card:null!=(w=null==(r=U.find(e=>"CEN"===e.position))?void 0:r.card)?w:null,isActive:"CEN"===K,label:"CEN",onClick:()=>ev("CEN")})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(O,{card:null!=(k=null==(o=U.find(e=>"POR"===e.position))?void 0:o.card)?k:null,isActive:"POR"===K,label:"POR",onClick:()=>ev("POR")})})]})]}),(0,a.jsxs)(v.$,{className:"mt-4 h-14 gap-2 bg-violet-600 font-semibold text-lg hover:bg-violet-700",disabled:!(J&&et.trim())||U.filter(e=>e.card).length<5,onClick:eb,children:[(0,a.jsx)(i.A,{className:"h-5 w-5"}),er?"Aggiorna formazione":"Salva formazione"]}),R&&(0,a.jsx)(h.Fc,{className:"mt-4",variant:"destructive",children:(0,a.jsx)(h.TN,{children:R})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"mb-4 flex items-center justify-between",children:(0,a.jsxs)("h2",{className:"font-bold text-slate-800 text-xl",children:["Seleziona"," ",K?(0,a.jsx)("span",{className:"text-violet-600",children:K}):"Giocatore"]})}),(0,a.jsxs)("div",{className:"mb-4 flex flex-wrap gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"font-medium text-sm",htmlFor:"league-filter",children:"Lega:"}),(0,a.jsxs)("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"league-filter",onChange:e=>{Q(e.target.value),q(I),H(null)},value:J,children:[(0,a.jsx)("option",{value:"",children:"Seleziona lega"}),eo.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"font-medium text-sm",htmlFor:"rarity-filter",children:"Rarit\xe0:"}),(0,a.jsxs)("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"rarity-filter",onChange:e=>W(e.target.value),value:V,children:[(0,a.jsx)("option",{value:"all",children:"Tutte"}),(0,a.jsx)("option",{value:"limited",children:"Limited"}),(0,a.jsx)("option",{value:"rare",children:"Rare"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"font-medium text-sm",htmlFor:"sort-by",children:"Ordina:"}),(0,a.jsxs)("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"sort-by",onChange:e=>Z(e.target.value),value:Y,children:[(0,a.jsx)("option",{value:"name",children:"Nome"}),(0,a.jsx)("option",{value:"team",children:"Squadra"}),(0,a.jsx)("option",{value:"l5",children:"Media L5"}),(0,a.jsx)("option",{value:"l15",children:"Media L15"}),(0,a.jsx)("option",{value:"l40",children:"Media L40"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.S,{checked:ee,id:"in-season-filter",onCheckedChange:e=>el(!0===e)}),(0,a.jsx)("label",{className:"cursor-pointer font-medium text-sm",htmlFor:"in-season-filter",children:"In-Season"})]}),(0,a.jsxs)("div",{className:"relative min-w-[200px] flex-1",children:[(0,a.jsx)(n,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-slate-400"}),(0,a.jsx)(p.p,{className:"h-11 rounded-xl border-slate-200 bg-slate-50 pl-10 text-slate-700 placeholder:text-slate-400",onChange:e=>B(e.target.value),placeholder:"Cerca giocatore...",value:$})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-3 xl:grid-cols-4",children:ed.map(e=>(0,a.jsx)("button",{"aria-label":"Seleziona ".concat(e.name),className:(0,N.cn)("text-left transition-all",K?"cursor-pointer hover:scale-[1.02] hover:shadow-lg":"cursor-not-allowed opacity-50"),disabled:!K,onClick:()=>{K&&(q(l=>{let t=l.map(l=>l.position===K?{...l,card:e}:l),a=["POR","DIF","CEN","ATT","EX"],r=(a.indexOf(K)+1)%a.length,s=!1;for(let e=0;e<a.length;e++){let e=a[r],l=t.find(l=>l.position===e);if(l&&!l.card){H(e),s=!0;break}r=(r+1)%a.length}return s||H(null),t}),B(""))},type:"button",children:(0,a.jsx)(m.H,{card:e,showAverages:!0,showPositions:!1})},e.slug))}),0===ed.length&&(0,a.jsx)("div",{className:"py-12 text-center text-slate-500",children:J?K?"Nessuna carta disponibile per questa posizione":"Seleziona uno slot per vedere le carte disponibili":"Seleziona una lega per vedere le carte disponibili"})]})]})]})}}},e=>{e.O(0,[608,499,529,75,441,255,358],()=>e(e.s=4632)),_N_E=e.O()}]);