(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[746],{848:(e,l,a)=>{"use strict";a.d(l,{CardsDashboard:()=>S});var r=a(5155),s=a(9559),t=a(1360);let n=(0,a(1847).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);var i=a(63),o=a(2115),c=a(3209),d=a(9220);let u={mobile:1,md:4,lg:5};function m(e){let{cards:l,columns:a=u,showEmptyMessage:s=!0,emptyMessage:t,showCardPositions:n=!0,showCardAverages:i=!0}=e;if(0===l.length&&s)return(0,r.jsx)(c.Zp,{children:(0,r.jsx)(c.Wu,{className:"py-12 text-center text-muted-foreground",children:null!=t?t:"No cards found"})});let o=(()=>{let e=["grid","grid-cols-1","gap-4"];return 2===a.md?e.push("md:grid-cols-2"):3===a.md?e.push("md:grid-cols-3"):4===a.md?e.push("md:grid-cols-4"):5===a.md?e.push("md:grid-cols-5"):6===a.md&&e.push("md:grid-cols-6"),2===a.lg?e.push("lg:grid-cols-2"):3===a.lg?e.push("lg:grid-cols-3"):4===a.lg?e.push("lg:grid-cols-4"):5===a.lg?e.push("lg:grid-cols-5"):6===a.lg&&e.push("lg:grid-cols-6"),e.join(" ")})();return(0,r.jsx)("div",{className:o,children:l.map(e=>(0,r.jsx)(d.H,{card:e,showAverages:i,showPositions:n},e.slug))})}var h=a(1650),g=a(8271),f=a(2559),v=a(7003),p=a(4916),x=a(8070),b=a(926);let j=(0,b.createServerReference)("00c2dde766822e370c07e189d4adb2fe7dfad89c06",b.callServer,void 0,b.findSourceMapURL,"logout");var y=a(373),w=a(809),N=a(8759);function k(e){var l;return null!=(l=({Goalkeeper:"POR",Defender:"DIF",Midfielder:"CEN",Forward:"ATT"})[e])?l:e}function S(){let e=(0,i.useRouter)(),[l,a]=(0,o.useState)(!0),[c,d]=(0,o.useState)(!1),[u,b]=(0,o.useState)(""),[S,C]=(0,o.useState)([]),[M,A]=(0,o.useState)(""),[E,L]=(0,o.useState)("all"),[P,T]=(0,o.useState)("all"),[_,D]=(0,o.useState)("all"),[F,O]=(0,o.useState)("name"),[R,U]=(0,o.useState)(""),[G,I]=(0,o.useState)(null),[K,H]=(0,o.useState)(!1);(0,x.KX)();let V=(0,o.useMemo)(()=>{let e=new Map,l=new Set;for(let t of S){var a,r,s;for(let n of null!=(s=null==(r=t.anyPlayer)||null==(a=r.activeClub)?void 0:a.activeCompetitions)?s:[])if("DOMESTIC_LEAGUE"===n.format&&n.country){let a=n.country,r="".concat(n.name,"|").concat(a.code);if(l.add(r),!y.jK||Object.hasOwn(y.UK,r)){let l=y.UK[r],a=null!=l?l:r;e.set(r,a)}}}if(y.jK&&l.size>0){let e=Array.from(l).filter(e=>!Object.hasOwn(y.UK,e));e.length>0&&console.log("Leagues found in cards but not in ACTIVE_LEAGUES config:",e)}return Array.from(e.entries()).map(e=>{let[l,a]=e;return{value:l,label:a}}).sort((e,l)=>e.label.localeCompare(l.label))},[S]),$=(0,o.useMemo)(()=>{let e=[...S];if("all"!==E&&(e=e.filter(e=>e.rarityTyped.toLowerCase()===E)),"all"!==P&&(e=e.filter(e=>{var l;return null==(l=e.anyPositions)?void 0:l.includes(P)})),"all"!==_){let[l,a]=_.split("|");e=e.filter(e=>{var r,s,t;return null==(t=e.anyPlayer)||null==(s=t.activeClub)||null==(r=s.activeCompetitions)?void 0:r.some(e=>{var r;return"DOMESTIC_LEAGUE"===e.format&&e.name===l&&(null==(r=e.country)?void 0:r.code)===a})})}return K&&(e=e.filter(e=>!0===e.inSeasonEligible)),e.sort((e,l)=>{var a,r,s,t,n,i,o,c,d,u,m,h,g,f;switch(F){case"name":return e.name.localeCompare(l.name);case"team":return(null!=(n=null==(r=e.anyPlayer)||null==(a=r.activeClub)?void 0:a.name)?n:"").localeCompare(null!=(i=null==(t=l.anyPlayer)||null==(s=t.activeClub)?void 0:s.name)?i:"");case"l5":return(null!=(o=l.l5Average)?o:0)-(null!=(c=e.l5Average)?c:0);case"l10":return(null!=(d=l.l10Average)?d:0)-(null!=(u=e.l10Average)?u:0);case"l15":return(null!=(m=l.l15Average)?m:0)-(null!=(h=e.l15Average)?h:0);case"l40":return(null!=(g=l.l40Average)?g:0)-(null!=(f=e.l40Average)?f:0);default:return 0}}),e},[S,E,P,_,F,K]),z=(0,o.useCallback)(async()=>{try{let e=await w.db.cache.get("user_cards");if(!e)return!1;let{timestamp:l,value:r,ttl:s}=e,t=Date.now()-l;if(s&&t>s)return await w.db.cache.delete("user_cards"),!1;return C(r.cards),A(r.userSlug),I(new Date(l)),a(!1),!0}catch(e){return!1}},[]),X=(0,o.useCallback)(async(e,l)=>{await w.db.cache.put({key:"user_cards",value:{cards:e,userSlug:l},timestamp:Date.now(),ttl:w.HX.LONG})},[]),q=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?d(!0):a(!0),b(""),U("Fetching cards...");try{let l=await (0,N.T7)({cacheTtl:e?0:void 0,enablePagination:y.b2,onProgress:(e,l)=>{U("Fetching page ".concat(e,"... (").concat(l," cards)"))}});C(l.cards),A(l.userSlug),I(new Date),await X(l.cards,l.userSlug)}catch(e){b(e instanceof Error?e.message:"Failed to fetch cards")}finally{a(!1),d(!1),U("")}},[X]),B=(0,o.useCallback)(async()=>{await z()||await q(!1)},[z,q]);(0,o.useEffect)(()=>{B()},[B]);let W=async()=>{await j(),e.push("/")},Y=async()=>{await (0,N.mL)(),await q(!1)};return l?(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsx)(h.k,{icon:"loader",message:R})}):c?(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsx)(h.k,{icon:"refresh",message:R})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(g.x,{}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"font-bold text-3xl",children:"Sorare AI Dashboard"}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:[M&&"Benvenuto, ".concat(M),G&&(0,r.jsxs)("span",{className:"ml-2 text-sm",children:["\xb7 Updated ",function(e){let l=new Date().getTime()-e.getTime(),a=Math.floor(l/6e4),r=Math.floor(l/36e5),s=Math.floor(l/864e5);return a<1?"just now":a<60?"".concat(a,"m ago"):r<24?"".concat(r,"h ago"):"".concat(s,"d ago")}(G)]})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(v.$,{disabled:c||l,onClick:()=>{q(!0)},variant:"outline",children:[(0,r.jsx)(s.A,{className:"mr-2 h-4 w-4 ".concat(c?"animate-spin":"")}),"Aggiorna carte"]}),(0,r.jsxs)(v.$,{disabled:c||l,onClick:Y,variant:"outline",children:[(0,r.jsx)(t.A,{className:"mr-2 h-4 w-4"}),"Pulisci cache"]}),(0,r.jsxs)(v.$,{onClick:W,variant:"outline",children:[(0,r.jsx)(n,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"font-medium text-sm",htmlFor:"rarity-filter",children:"Rarit\xe0:"}),(0,r.jsxs)("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"rarity-filter",onChange:e=>L(e.target.value),value:E,children:[(0,r.jsx)("option",{value:"all",children:"Tutte"}),(0,r.jsx)("option",{value:"limited",children:"Limited"}),(0,r.jsx)("option",{value:"rare",children:"Rare"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"font-medium text-sm",htmlFor:"position-filter",children:"Ruolo:"}),(0,r.jsxs)("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"position-filter",onChange:e=>T(e.target.value),value:P,children:[(0,r.jsx)("option",{value:"all",children:"Tutti"}),(0,r.jsx)("option",{value:"Goalkeeper",children:k("Goalkeeper")}),(0,r.jsx)("option",{value:"Defender",children:k("Defender")}),(0,r.jsx)("option",{value:"Midfielder",children:k("Midfielder")}),(0,r.jsx)("option",{value:"Forward",children:k("Forward")})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"font-medium text-sm",htmlFor:"league-filter",children:"Lega:"}),(0,r.jsxs)("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"league-filter",onChange:e=>D(e.target.value),value:_,children:[(0,r.jsx)("option",{value:"all",children:"Tutte"}),V.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"font-medium text-sm",htmlFor:"sort-by",children:"Ordina per:"}),(0,r.jsxs)("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"sort-by",onChange:e=>O(e.target.value),value:F,children:[(0,r.jsx)("option",{value:"name",children:"Nome"}),(0,r.jsx)("option",{value:"team",children:"Squadra"}),(0,r.jsx)("option",{value:"l5",children:"Media L5"}),(0,r.jsx)("option",{value:"l15",children:"Media L15"}),(0,r.jsx)("option",{value:"l40",children:"Media L40"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.S,{checked:K,id:"in-season-filter",onCheckedChange:e=>H(!0===e)}),(0,r.jsx)("label",{className:"cursor-pointer font-medium text-sm",htmlFor:"in-season-filter",children:"In-Season"})]})]}),u&&(0,r.jsx)(f.Fc,{variant:"destructive",children:(0,r.jsx)(f.TN,{children:u})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("h2",{className:"font-bold text-2xl",children:["Your Cards (",$.length,")"]}),(0,r.jsx)(m,{cards:$,columns:{lg:5,md:4,mobile:1},emptyMessage:"Nessuna carta trovata con i filtri selezionati",showCardAverages:!0,showCardPositions:!1})]})]})}},926:(e,l,a)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),!function(e,l){for(var a in l)Object.defineProperty(e,a,{enumerable:!0,get:l[a]})}(l,{callServer:function(){return r.callServer},createServerReference:function(){return t.createServerReference},findSourceMapURL:function(){return s.findSourceMapURL}});let r=a(1209),s=a(5153),t=a(7197)},1360:(e,l,a)=>{"use strict";a.d(l,{A:()=>r});let r=(0,a(1847).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},9850:(e,l,a)=>{Promise.resolve().then(a.bind(a,848))}},e=>{e.O(0,[608,499,529,75,441,255,358],()=>e(e.s=9850)),_N_E=e.O()}]);