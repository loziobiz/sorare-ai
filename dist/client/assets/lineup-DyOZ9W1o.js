import{j as e,r as n,u as pe,a as be}from"./main-DsfbD5fP.js";import{u as ve,d as y,D as je,f as ye,L as Ne,S as we,A as le,P as Ce}from"./sorare-api-D4coTWHb.js";import{C as Se,V as ke,a as Ae,S as Fe,b as N,g as F,c as Te,d as Ie}from"./checkbox-Mek54HdC.js";import{c as E,e as w,B as Ee,A as Le,b as Pe}from"./button-DJ2CAYQs.js";import{I as se}from"./input-Dd4hXJFi.js";const Me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],De=E("circle-alert",Me);const ze=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Oe=E("circle-check-big",ze);const _e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Re=E("circle-x",_e);const $e=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Be=E("plus",$e);const Ge=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],oe=E("x",Ge);function Xe({message:a,type:r="success",duration:i=3e3,onClose:c}){const[d,f]=n.useState(!0);n.useEffect(()=>{const m=setTimeout(()=>{f(!1),setTimeout(()=>c?.(),300)},i);return()=>clearTimeout(m)},[i,c]);const g=()=>{f(!1),setTimeout(()=>c?.(),300)},p={success:e.jsx(Oe,{className:"h-5 w-5 text-green-500"}),error:e.jsx(Re,{className:"h-5 w-5 text-red-500"}),info:e.jsx(De,{className:"h-5 w-5 text-blue-500"})},L={success:"bg-green-50 border-green-200",error:"bg-red-50 border-red-200",info:"bg-blue-50 border-blue-200"};return e.jsxs("div",{className:w("fixed right-4 bottom-4 z-50 flex items-center gap-3 rounded-lg border p-4 shadow-lg transition-all duration-300",L[r],d?"translate-y-0 opacity-100":"translate-y-4 opacity-0"),children:[p[r],e.jsx("span",{className:"font-medium text-slate-700 text-sm",children:a}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600",onClick:g,type:"button",children:e.jsx(oe,{className:"h-4 w-4"})})]})}function Ue({toasts:a,onRemove:r}){return e.jsx("div",{className:"fixed right-4 bottom-4 z-50 flex flex-col gap-2",children:a.map(i=>e.jsx(Xe,{message:i.message,onClose:()=>r(i.id),type:i.type},i.id))})}let qe=0;function ae(a,r,i="success"){const c=`toast-${qe++}`;a(d=>[...d,{id:c,message:r,type:i}]),setTimeout(()=>{a(d=>d.filter(f=>f.id!==c))},3e3)}function T({label:a,card:r,isActive:i,onClick:c}){return r?e.jsxs("button",{"aria-label":`Rimuovi ${r.name}`,className:"group relative transition-transform hover:scale-105",onClick:c,type:"button",children:[e.jsx("div",{className:"absolute top-1 right-1 z-20 rounded-full bg-black/60 p-1 opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx(oe,{className:"h-4 w-4 text-white"})}),r.pictureUrl?e.jsx("img",{alt:r.name,className:"h-50 w-32 rounded-lg object-cover shadow-lg",height:176,loading:"lazy",src:r.pictureUrl,width:128}):e.jsx("div",{className:"flex h-44 w-32 items-center justify-center rounded-lg bg-slate-700 font-bold text-white text-xl shadow-lg",children:r.name.charAt(0)})]}):e.jsx("button",{"aria-label":`Seleziona ${a}`,className:w("group flex flex-col items-center transition-transform hover:scale-105",i&&"scale-105"),onClick:c,type:"button",children:e.jsxs("div",{className:w("flex h-44 w-32 flex-col items-center justify-center rounded-xl border-2 border-dashed transition-all",i?"border-violet-400 bg-violet-500/20":"border-white/40 bg-white/10 hover:border-white/60 hover:bg-white/20"),children:[e.jsx("span",{className:w("mb-2 font-semibold text-sm",i?"text-violet-200":"text-white/70"),children:a}),e.jsx("div",{className:w("flex h-10 w-10 items-center justify-center rounded-full border-2 border-dashed transition-colors",i?"border-violet-300 text-violet-200":"border-white/40 text-white/50 group-hover:border-white/60"),children:e.jsx(Be,{className:"h-5 w-5"})})]})})}const Ve={ATT:["Forward"],EX:["Forward","Midfielder","Defender"],DIF:["Defender"],CEN:["Midfielder"],POR:["Goalkeeper"]},I=[{position:"ATT",card:null},{position:"EX",card:null},{position:"DIF",card:null},{position:"CEN",card:null},{position:"POR",card:null}];function re(a,r){return a?r?"Nessuna carta disponibile per questa posizione":"Seleziona uno slot per vedere le carte disponibili":"Seleziona una lega per vedere le carte disponibili"}function Ke(a){return Object.hasOwn(le,a)}function He(a){return le[a]??a}function Qe(a){const r=new Map;for(const i of a)for(const c of i.anyPlayer?.activeClub?.activeCompetitions??[])if(c.name==="NBA")r.set("NBA","NBA");else if(c.format==="DOMESTIC_LEAGUE"&&c.country){const d=`${c.name}|${c.country.code}`;Ke(d)&&r.set(d,He(d))}return r}function We(a){const r=[...I];if(!a.slots||a.slots.length===0)return r;for(const i of a.slots){const c=a.cards.find(d=>d.slug===i.cardSlug);if(c){const d=r.findIndex(f=>f.position===i.position);d!==-1&&(r[d]={position:i.position,card:c})}}return r}function Je(a){const r=[...I];for(const i of a.cards){const c=Ze(i);if(c){const d=r.findIndex(f=>f.position===c);d!==-1&&(r[d]={position:c,card:i})}}return r}function Ye(a){return a.slots&&a.slots.length>0?We(a):Je(a)}function Ze(a){if(!a.anyPositions||a.anyPositions.length===0)return null;const r=a.anyPositions[0];return r==="Goalkeeper"?"POR":r==="Defender"?"DIF":r==="Midfielder"?"CEN":r==="Forward"?"ATT":null}function et(){const a=pe(),r=be({from:"/lineup"}),i=new URLSearchParams(r),[c,d]=n.useState(!0),[f,g]=n.useState(""),[p,L]=n.useState([]),[m,C]=n.useState(I),[u,S]=n.useState(null),[P,U]=n.useState(""),[b,q]=n.useState(""),[M,ne]=n.useState("all"),[O,ie]=n.useState("l5"),[_,ce]=n.useState(!1),[k,R]=n.useState(""),[$,V]=n.useState(null),[B,de]=n.useState("list"),[h,ue]=n.useState("name"),[x,me]=n.useState("asc"),[fe,G]=n.useState([]),v=(t,s)=>{ue(t),me(s)};ve();const he=n.useMemo(()=>{const t=Qe(p);return Array.from(t.entries()).map(([s,l])=>({value:s,label:l})).sort((s,l)=>s.label.localeCompare(l.label))},[p]),K=n.useMemo(()=>new Set(m.filter(t=>t.card).map(t=>t.card?.slug)),[m]),X=n.useMemo(()=>{let t=p.filter(s=>!K.has(s.slug));if(t=t.filter(s=>s.sealed!==!0),b){const[s,l]=b.split("|");t=t.filter(o=>o.anyPlayer?.activeClub?.activeCompetitions?.some(j=>j.format==="DOMESTIC_LEAGUE"&&j.name===s&&j.country?.code===l))}if(M!=="all"&&(t=t.filter(s=>s.rarityTyped.toLowerCase()===M)),u){const s=Ve[u];t=t.filter(l=>l.anyPositions?.some(o=>s.includes(o)))}if(P.trim()){const s=P.toLowerCase();t=t.filter(l=>l.name.toLowerCase().includes(s)||l.anyPlayer?.activeClub?.name?.toLowerCase().includes(s))}return _&&(t=t.filter(s=>s.inSeasonEligible===!0)),t.sort((s,l)=>{switch(O){case"name":return s.name.localeCompare(l.name);case"team":return(s.anyPlayer?.activeClub?.name??"").localeCompare(l.anyPlayer?.activeClub?.name??"");case"l5":return(l.l5Average??0)-(s.l5Average??0);case"l10":return(l.l10Average??0)-(s.l10Average??0);case"l15":return(l.l15Average??0)-(s.l15Average??0);case"l40":return(l.l40Average??0)-(s.l40Average??0);default:return 0}}),t},[p,K,b,M,u,P,O,_]);n.useMemo(()=>m.filter(s=>s.card).length>=3?2:0,[m]);const H=n.useCallback(async()=>{try{const t=await y.cache.get("user_cards");if(!t)return!1;const{timestamp:s,value:l,ttl:o}=t,j=Date.now()-s;return o&&j>o?(await y.cache.delete("user_cards"),!1):(L(l.cards),d(!1),!0)}catch{return!1}},[]),Q=n.useCallback(async(t,s)=>{await y.cache.put({key:"user_cards",value:{cards:t,userSlug:s},timestamp:Date.now(),ttl:je.LONG})},[]),W=n.useCallback(async()=>{d(!0),g("");try{const t=await ye({enablePagination:!0});L(t.cards),await Q(t.cards,t.userSlug)}catch(t){g(t instanceof Error?t.message:"Errore nel caricamento")}finally{d(!1)}},[Q]),J=n.useCallback(async()=>{await H()||await W()},[H,W]);n.useEffect(()=>{J()},[J]),n.useEffect(()=>{const t=i.get("edit");if(!(t&&p.length))return;(async()=>{try{const l=Number.parseInt(t,10),o=await y.savedFormations.get(l);o&&(V(l),R(o.name),q(o.league),C(Ye(o)))}catch(l){console.error("Error loading formation:",l)}})()},[i,p]);const A=t=>{m.find(l=>l.position===t)?.card?(C(l=>l.map(o=>o.position===t?{...o,card:null}:o)),S(null)):S(u===t?null:t)},Y=t=>{u&&(C(s=>{const l=s.map(z=>z.position===u?{...z,card:t}:z),o=["POR","DIF","CEN","ATT","EX"];let D=(o.indexOf(u)+1)%o.length,Z=!1;for(const z of o){const ee=o[D],te=l.find(ge=>ge.position===ee);if(te&&!te.card){S(ee),Z=!0;break}D=(D+1)%o.length}return Z||S(null),l}),U(""))},xe=async()=>{if(m.filter(s=>s.card).length<5){g("Completa la formazione prima di confermare");return}if(!k.trim()){g("Inserisci un nome per la formazione");return}try{const s=m.map(o=>o.card).filter(o=>o!==null),l=m.filter(o=>o.card!==null).map(o=>({position:o.position,cardSlug:o.card?.slug??""})).filter(o=>o.cardSlug!=="");$?(await y.savedFormations.update($,{name:k.trim(),league:b,cards:s,slots:l}),ae(G,"Formazione aggiornata con successo!","success")):(await y.savedFormations.add({name:k.trim(),league:b,cards:s,slots:l,createdAt:Date.now()}),ae(G,"Formazione salvata con successo!","success")),R(""),C(I),V(null),g(""),a.navigate({to:"/saved-lineups"})}catch(s){g(s instanceof Error?s.message:"Errore nel salvataggio")}};return c?e.jsx("div",{className:"flex h-[80vh] items-center justify-center",children:e.jsx(Ne,{icon:"loader",message:"Caricamento carte..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(we,{}),e.jsx(Ue,{onRemove:t=>G(s=>s.filter(l=>l.id!==t)),toasts:fe}),e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:gap-6",children:[e.jsxs("div",{className:"flex max-h-[calc(100vh-6rem)] shrink-0 flex-col overflow-y-auto lg:w-[420px]",children:[e.jsx("div",{className:"mb-3",children:e.jsx(se,{className:"h-9",id:"formation-name",onChange:t=>R(t.target.value),placeholder:"Nome formazione (obbligatorio)",required:!0,value:k})}),e.jsxs(Ee,{className:"mb-2 h-9 gap-2 bg-violet-600 font-semibold text-base hover:bg-violet-700",disabled:!k.trim()||m.filter(t=>t.card).length<5,onClick:xe,children:[e.jsx(Se,{className:"h-5 w-5"}),$?"Aggiorna formazione":"Salva formazione"]}),f&&e.jsx(Le,{className:"mb-3",variant:"destructive",children:e.jsx(Pe,{children:f})}),e.jsxs("div",{className:"relative flex aspect-[21/31] flex-col overflow-hidden rounded-xl bg-gradient-to-b from-emerald-600 to-emerald-700 shadow-lg",children:[e.jsx("div",{className:"absolute inset-5 rounded-lg border-2 border-white/30"}),e.jsx("div",{className:"absolute top-1/2 right-5 left-5 h-0.5 -translate-y-1/2 bg-white/30"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 h-28 w-28 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-white/30"}),e.jsx("div",{className:"absolute bottom-5 left-1/2 h-24 w-40 -translate-x-1/2 border-2 border-white/30 border-b-0"}),e.jsx("div",{className:"absolute top-5 left-1/2 h-24 w-40 -translate-x-1/2 border-2 border-white/30 border-t-0"}),e.jsxs("div",{className:"relative z-10 flex h-full flex-col justify-between gap-2 px-4 py-3",children:[e.jsxs("div",{className:"flex justify-around",children:[e.jsx(T,{card:m.find(t=>t.position==="ATT")?.card??null,isActive:u==="ATT",label:"ATT",onClick:()=>A("ATT")}),e.jsx(T,{card:m.find(t=>t.position==="EX")?.card??null,isActive:u==="EX",label:"EX",onClick:()=>A("EX")})]}),e.jsxs("div",{className:"flex justify-around",children:[e.jsx(T,{card:m.find(t=>t.position==="DIF")?.card??null,isActive:u==="DIF",label:"DIF",onClick:()=>A("DIF")}),e.jsx(T,{card:m.find(t=>t.position==="CEN")?.card??null,isActive:u==="CEN",label:"CEN",onClick:()=>A("CEN")})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(T,{card:m.find(t=>t.position==="POR")?.card??null,isActive:u==="POR",label:"POR",onClick:()=>A("POR")})})]})]})]}),e.jsxs("div",{className:"flex max-h-[calc(100vh-6rem)] max-w-[1000px] flex-1 flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-20 bg-white pb-2",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h2",{className:"font-bold text-slate-800 text-xl",children:["Seleziona"," ",u?e.jsx("span",{className:"text-violet-600",children:u}):"Giocatore"]}),e.jsx(ke,{onViewModeChange:de,viewMode:B})]}),e.jsxs("div",{className:"mb-4 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-medium text-sm",htmlFor:"league-filter",children:"Lega:"}),e.jsxs("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"league-filter",onChange:t=>{q(t.target.value),C(I),S(null)},value:b,children:[e.jsx("option",{value:"",children:"Seleziona lega"}),he.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-medium text-sm",htmlFor:"rarity-filter",children:"RaritÃ :"}),e.jsxs("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"rarity-filter",onChange:t=>ne(t.target.value),value:M,children:[e.jsx("option",{value:"all",children:"Tutte"}),e.jsx("option",{value:"limited",children:"Limited"}),e.jsx("option",{value:"rare",children:"Rare"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-medium text-sm",htmlFor:"sort-by",children:"Ordina:"}),e.jsxs("select",{className:"flex h-9 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",id:"sort-by",onChange:t=>ie(t.target.value),value:O,children:[e.jsx("option",{value:"name",children:"Nome"}),e.jsx("option",{value:"team",children:"Squadra"}),e.jsx("option",{value:"l5",children:"Media L5"}),e.jsx("option",{value:"l15",children:"Media L15"}),e.jsx("option",{value:"l40",children:"Media L40"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{checked:_,id:"in-season-filter",onCheckedChange:t=>ce(t===!0)}),e.jsx("label",{className:"cursor-pointer font-medium text-sm",htmlFor:"in-season-filter",children:"In-Season"})]}),e.jsxs("div",{className:"relative min-w-[200px] flex-1",children:[e.jsx(Fe,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-slate-400"}),e.jsx(se,{className:"h-11 rounded-xl border-slate-200 bg-slate-50 pl-10 text-slate-700 placeholder:text-slate-400",onChange:t=>U(t.target.value),placeholder:"Cerca giocatore...",value:P})]})]}),B==="list"&&e.jsx("div",{className:"mt-2 overflow-x-auto rounded-t-md border border-b-0 bg-white",children:e.jsx("table",{className:"w-full max-w-[1000px] table-fixed text-sm",children:e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"h-10 cursor-pointer select-none whitespace-nowrap px-2 text-left align-middle font-medium text-foreground hover:bg-muted/80",onClick:()=>v("name",h==="name"&&x==="asc"?"desc":"asc"),style:{width:N.name},children:e.jsxs("div",{className:"flex items-center",children:["Giocatore",F("name",h,x)]})}),e.jsx("th",{className:"h-10 cursor-pointer select-none whitespace-nowrap px-2 text-left align-middle font-medium text-foreground hover:bg-muted/80",onClick:()=>v("team",h==="team"&&x==="asc"?"desc":"asc"),style:{width:N.team},children:e.jsxs("div",{className:"flex items-center",children:["Squadra",F("team",h,x)]})}),e.jsx("th",{className:"h-10 whitespace-nowrap px-2 text-left align-middle font-medium text-foreground",style:{width:N.forma},children:e.jsx("div",{className:"flex items-center",children:"Forma"})}),e.jsx("th",{className:"h-10 cursor-pointer select-none whitespace-nowrap px-2 text-left align-middle font-medium text-foreground hover:bg-muted/80",onClick:()=>v("l5",h==="l5"&&x==="asc"?"desc":"asc"),style:{width:N.l5},children:e.jsxs("div",{className:"flex items-center",children:["L5",F("l5",h,x)]})}),e.jsx("th",{className:"h-10 cursor-pointer select-none whitespace-nowrap px-2 text-left align-middle font-medium text-foreground hover:bg-muted/80",onClick:()=>v("l15",h==="l15"&&x==="asc"?"desc":"asc"),style:{width:N.l15},children:e.jsxs("div",{className:"flex items-center",children:["L15",F("l15",h,x)]})}),e.jsx("th",{className:"h-10 cursor-pointer select-none whitespace-nowrap px-2 text-left align-middle font-medium text-foreground hover:bg-muted/80",onClick:()=>v("l40",h==="l40"&&x==="asc"?"desc":"asc"),style:{width:N.l40},children:e.jsxs("div",{className:"flex items-center",children:["L40",F("l40",h,x)]})})]})})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:B==="grid"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-3 xl:grid-cols-4",children:X.map(t=>e.jsx("button",{"aria-label":`Seleziona ${t.name}`,className:w("text-left transition-all",u?"cursor-pointer hover:scale-[1.02] hover:shadow-lg":"cursor-not-allowed opacity-50"),disabled:!u,onClick:()=>Y(t),type:"button",children:e.jsx(Te,{card:t,showAverages:!0,showPositions:!1})},t.slug))}),X.length===0&&e.jsx("div",{className:"py-12 text-center text-slate-500",children:re(b,u)})]}):e.jsx(Ie,{cards:X,disabled:!u,emptyMessage:re(b,u),onCardClick:Y,onSort:v,showHeader:!1,sortDirection:x,sortKey:h})})]})]})]})}function ot(){return e.jsx(Ce,{containerSize:"wide",showNav:!0,children:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"flex h-[50vh] items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Caricamento..."})}),children:e.jsx(et,{})})})}export{ot as component};
