import{u as w,r as o,j as e}from"./main-UrG3l67e.js";import{d as C,A as y,L as b,S as z}from"./sorare-api-BEyfOWLI.js";import{c as E,B as m,A as S,a as L,b as k,d as F}from"./button-C3H20fmt.js";import{u as D,T as M}from"./use-cards-2bxDmIsF.js";const T=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],B=E("pencil",T);function I({card:t}){return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.pictureUrl&&e.jsx("img",{alt:t.name,className:"h-auto max-w-[95px] rounded-lg",height:100,loading:"lazy",src:t.pictureUrl,width:85}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-center text-[10px]",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"L5"}),e.jsx("div",{className:"font-medium",children:t.l5Average?.toFixed(1)??"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"L15"}),e.jsx("div",{className:"font-medium",children:t.l15Average?.toFixed(1)??"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"XP"}),e.jsx("div",{className:"font-medium",children:t.power?Math.round((Number.parseFloat(t.power)-1)*100):"-"})]})]})]})}function P({formation:t,onEdit:x,onDelete:f,currentCardsMap:g}){const r={POR:0,DIF:1,CEN:2,ATT:3,EX:4,EXTRA:4},h=[...t.cards].sort((a,l)=>{const p=t.slots.find(d=>d.cardSlug===a.slug),c=t.slots.find(d=>d.cardSlug===l.slug);if(!(p&&c))return 0;const j=r[p.position]??999,v=r[c.position]??999;return j-v}).map(a=>{const l=g.get(a.slug);return l?{...a,power:l.power}:a});return e.jsxs("div",{className:"space-y-4 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",style:{maxWidth:"480px"},children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{children:e.jsx("h3",{className:"font-bold text-slate-800 text-xl",children:t.name})})}),e.jsx("div",{className:"flex gap-1 overflow-x-auto pb-2",children:h.map(a=>e.jsx(I,{card:a},a.slug))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{className:"h-8 flex-1 px-2 text-xs",onClick:()=>x(t),variant:"outline",children:[e.jsx(B,{className:"mr-1 h-3 w-3"}),"Modifica"]}),e.jsxs(m,{className:"h-8 flex-1 px-2 text-xs",onClick:()=>t.id&&f(t.id),variant:"destructive",children:[e.jsx(M,{className:"mr-1 h-3 w-3"}),"Cancella"]})]})]})}function R(){const t=w(),{cards:x}=D(),[f,g]=o.useState(!0),[r,h]=o.useState([]),[a,l]=o.useState(null),p=o.useMemo(()=>new Map(x.map(s=>[s.slug,{power:s.power}])),[x]),c=o.useCallback(async()=>{try{const n=(await C.savedFormations.toArray()).sort((i,u)=>i.league!==u.league?i.league.localeCompare(u.league):u.createdAt-i.createdAt);h(n)}catch(s){console.error("Error loading formations:",s)}finally{g(!1)}},[]);o.useEffect(()=>{c()},[c]);const j=s=>{t.navigate({to:"/lineup",search:{edit:s.id}})},v=s=>{l(s)},d=async()=>{if(a!==null)try{await C.savedFormations.delete(a),h(s=>s.filter(n=>n.id!==a)),l(null)}catch(s){console.error("Error deleting formation:",s)}},A=o.useMemo(()=>{const s={};for(const n of r){const[i,u]=n.league.split("|"),N=y[n.league]??`${i} (${u})`;s[N]||(s[N]=[]),s[N].push(n)}return s},[r]);return f?e.jsx("div",{className:"flex h-[80vh] items-center justify-center",children:e.jsx(b,{icon:"loader",message:"Caricamento formazioni..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(z,{}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-3xl",children:"Formazioni Salvate"}),e.jsxs("p",{className:"text-muted-foreground",children:[r.length," ",r.length===1?"formazione":"formazioni"]})]}),r.length===0?e.jsxs("div",{className:"py-12 text-center text-slate-500",children:[e.jsx("p",{children:"Nessuna formazione salvata."}),e.jsx(m,{className:"mt-4",onClick:()=>t.navigate({to:"/lineup"}),children:"Crea una nuova formazione"})]}):e.jsx("div",{className:"space-y-8",children:Object.entries(A).map(([s,n])=>e.jsxs("div",{children:[e.jsx("h2",{className:"mb-4 font-bold text-slate-700 text-xl",children:s}),e.jsx("div",{className:"grid gap-2 lg:grid-cols-3",children:n.map(i=>e.jsx(P,{currentCardsMap:p,formation:i,onDelete:v,onEdit:j},i.id))})]},s))}),a!==null&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs(S,{className:"max-w-md",variant:"destructive",children:[e.jsx(L,{children:"Conferma cancellazione"}),e.jsx(k,{children:"Sei sicuro di voler cancellare questa formazione? Questa azione non puÃ² essere annullata."}),e.jsxs(F,{className:"mt-4 flex gap-2",children:[e.jsx(m,{onClick:()=>l(null),variant:"outline",children:"Annulla"}),e.jsx(m,{onClick:d,variant:"destructive",children:"Conferma cancellazione"})]})]})})]})}function q(){return e.jsx(R,{})}export{q as component};
