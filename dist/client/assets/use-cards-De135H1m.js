import{c as f}from"./button-DJ2CAYQs.js";import{r as c}from"./main-DsfbD5fP.js";import{u as p,f as m,E as C,c as w,d as i,D as y}from"./sorare-api-D4coTWHb.js";const k=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],D=f("trash-2",k),d="user_cards";async function L(){try{const r=await i.cache.get(d);if(!r)return null;const{timestamp:e,value:s,ttl:n}=r,l=Date.now()-e;return n&&l>n?(await i.cache.delete(d),null):{...s,timestamp:e}}catch{return null}}async function v(r,e){await i.cache.put({key:d,value:{cards:r,userSlug:e},timestamp:Date.now(),ttl:y.LONG})}function P(){const[r,e]=c.useState({cards:[],userSlug:"",isLoading:!0,isRefreshing:!1,error:"",loadingProgress:"",lastUpdate:null});p();const s=c.useCallback(async(t=!1)=>{e(a=>({...a,isLoading:!t,isRefreshing:t,error:"",loadingProgress:"Fetching cards..."}));try{const a=await m({cacheTtl:t?0:void 0,enablePagination:C,onProgress:(o,g)=>{e(h=>({...h,loadingProgress:`Fetching page ${o}... (${g} cards)`}))}});await v(a.cards,a.userSlug),e(o=>({...o,cards:a.cards,userSlug:a.userSlug,lastUpdate:new Date,isLoading:!1,isRefreshing:!1,loadingProgress:""}))}catch(a){e(o=>({...o,error:a instanceof Error?a.message:"Failed to fetch cards",isLoading:!1,isRefreshing:!1,loadingProgress:""}))}},[]),n=c.useCallback(async()=>{const t=await L();if(t){e(a=>({...a,cards:t.cards,userSlug:t.userSlug,lastUpdate:new Date(t.timestamp),isLoading:!1}));return}await s(!1)},[s]);c.useEffect(()=>{n()},[n]);const l=c.useCallback(()=>{s(!0)},[s]),u=c.useCallback(async()=>{await w(),await s(!1)},[s]);return{...r,refresh:l,clearCache:u}}export{D as T,P as u};
